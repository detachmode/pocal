<UserControl x:Class="Pocal.SDV_Control"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
    xmlns:cimbalinoBehaviors="clr-namespace:Cimbalino.Toolkit.Behaviors;assembly=Cimbalino.Toolkit"
    mc:Ignorable="d"
    xmlns:viewmodel="clr-namespace:Pocal.ViewModel"
    FontFamily="{StaticResource PhoneFontFamilyNormal}"
    FontSize="{StaticResource PhoneFontSizeNormal}"
    Foreground="{StaticResource PhoneForegroundBrush}"
    d:DesignHeight="480" d:DesignWidth="480"
    d:DataContext="{d:DesignInstance IsDesignTimeCreatable=True, Type=viewmodel:MainViewModel}"
    >

    <Grid x:Name="LayoutRoot">
        <!--******** ******** ******** -->
        <!--******** SDV BODY ******** -->
        <!--******** ********** ******** -->
        <Border x:Name="SingleDayHeader" Canvas.ZIndex="3"  Margin="0,-41,0,0" Height="41" VerticalAlignment="Top" BorderThickness="0,1,0,1" BorderBrush="#FF5D5D5D" >
            <Border.Background>
                <SolidColorBrush Color="{StaticResource PhoneAccentColor}"/>
            </Border.Background>
            <TextBlock  x:Name="SingleDayWindowHeader" 
						Foreground="White"
						Style="{StaticResource PhoneTextTitle3Style}"
						Text="{Binding SingleDayViewModel.TappedDay.DT, Converter={StaticResource windowHeaderDateConverter}}" 
						Margin="148,-4,24,0" 
						FontSize="26" VerticalAlignment="Center" 
						HorizontalAlignment="Right">
						<!--<TextBlock.Foreground>
                			<SolidColorBrush Color="{StaticResource PhoneButtonBasePressedForegroundColor}"/>
                        </TextBlock.Foreground>-->
            </TextBlock>
        </Border>
        <ScrollViewer x:Name="SingleDayScrollViewer"  VerticalScrollBarVisibility="Hidden" ManipulationCompleted="SingleDayScrollViewer_ManipulationCompleted">
            <Grid>
                <Grid.Background>
                    <SolidColorBrush Color="{StaticResource Color90Black}"/>
                </Grid.Background>
                <StackPanel>
                    <ItemsControl  x:Name="AllDayAppointments" Margin="24,0,0,0" ItemsSource="{Binding SingleDayViewModel.TappedDay.PocalApptsOfDay}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid  x:Name="AllDaySDVAppt"  Tap="SDV_AppointmentTap" Visibility="{Binding AllDay, Converter={StaticResource revertBoolean}}">
                                    <TextBlock Margin="4,12,0,12" Text="{Binding Subject}" Foreground="{Binding CalColor}"   FontWeight="SemiBold"/>
                                    <Grid.Resources>
                                        <Storyboard x:Name="tapFeedback">
                                            <Storyboard>
                                                <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(CompositeTransform.TranslateY)"  Storyboard.TargetName="AllDaySDVAppt">
                                                    <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                                                    <EasingDoubleKeyFrame KeyTime="0:0:0.1" Value="-15"/>
                                                    <EasingDoubleKeyFrame KeyTime="0:0:0.2" Value="0"/>
                                                </DoubleAnimationUsingKeyFrames>
                                            </Storyboard>
                                        </Storyboard>
                                    </Grid.Resources>
                                    <Grid.RenderTransform>
                                        <CompositeTransform/>
                                    </Grid.RenderTransform>
                                    <Grid.CacheMode>
                                        <BitmapCache/>
                                    </Grid.CacheMode>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                    <Border Height="1" Background="#FF807C7C"/>
                    <Grid x:Name="HourLinesGridAppointments">
                        <ItemsControl x:Name="hourlines"
									ScrollViewer.VerticalScrollBarVisibility="Disabled"
									ItemsSource="{Binding SingleDayViewModel.hourLines, Mode=OneWay}" >
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid Tap="SDV_Hourline_Tap">
                                        <Grid.Background>
                                            <SolidColorBrush x:Name="MyAnimatedBrush"  Color="{StaticResource Color90Black}"></SolidColorBrush>
                                        </Grid.Background>
                                        <Grid.Resources>
                                            <Storyboard x:Key="tapFeedback">
                                                <ColorAnimationUsingKeyFrames                 
                                                            Storyboard.TargetProperty="Color"
                                                            Storyboard.TargetName="MyAnimatedBrush"
                                                            Duration="0:0:6" FillBehavior="HoldEnd" >
                                                    <ColorAnimationUsingKeyFrames.KeyFrames>
                                                        <LinearColorKeyFrame Value="DarkGray" KeyTime="0:0:0.1" />
                                                        <LinearColorKeyFrame Value="{StaticResource Color90Black}" KeyTime="0:0:0.4" />
                                                    </ColorAnimationUsingKeyFrames.KeyFrames>
                                                </ColorAnimationUsingKeyFrames>
                                            </Storyboard>
                                        </Grid.Resources>
                                        <Border 
													BorderThickness="0,0.2" Height="{Binding Height}" 
													BorderBrush="#FF767676">
                                            <TextBlock  Text="{Binding Text, Mode=OneWay}" Margin="7,6" FontSize="20"/>
                                        </Border>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <ItemsControl x:Name="AppointmentsOnGrid"  ScrollViewer.VerticalScrollBarVisibility="Disabled"   
                                                ItemsSource="{Binding SingleDayViewModel.TappedDay.PocalApptsOfDay, Mode=OneWay}" >
                            <!--unnötig? NEIN! Sonst fängt die YPos nicht für jedes Element bei Null an. ItemsPanel ist standardmässig ein Stackpanel-->
                            <ItemsControl.ItemsPanel>
                                <ItemsPanelTemplate>
                                    <Grid VerticalAlignment="Top">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                    </Grid>
                                </ItemsPanelTemplate>
                            </ItemsControl.ItemsPanel>
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Grid                                            
												x:Name="apptSDV"
												Margin="72,-1,0,0"
												Tap="SDV_AppointmentTap"
												RenderTransformOrigin="0.5,0"
												VerticalAlignment="Top" HorizontalAlignment="Left" >
                                        <Grid.Background>
                                            <SolidColorBrush x:Name="MyAnimatedBrush"  Color="{StaticResource Color90Black}"></SolidColorBrush>
                                        </Grid.Background>
                                        <Grid.Resources>
                                            <Storyboard x:Key="tapFeedback">
                                                <ColorAnimationUsingKeyFrames                 
                                                            Storyboard.TargetProperty="Color"
                                                            Storyboard.TargetName="MyAnimatedBrush"
                                                            Duration="0:0:6" FillBehavior="HoldEnd">
                                                    <ColorAnimationUsingKeyFrames.KeyFrames>
                                                        <LinearColorKeyFrame Value="White" KeyTime="0:0:0.1" />
                                                        <LinearColorKeyFrame Value="White" KeyTime="0:0:0.25" />
                                                        <LinearColorKeyFrame Value="{StaticResource Color90Black}" KeyTime="0:0:0.4" />
                                                    </ColorAnimationUsingKeyFrames.KeyFrames>
                                                </ColorAnimationUsingKeyFrames>


                                            </Storyboard>
                                            <EventTrigger x:Name="event" RoutedEvent="Canvas.Loaded">
                                                <BeginStoryboard>
                                                    <Storyboard x:Name="StoryboardOnDataTemplate">
                                                        <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.Opacity)" Storyboard.TargetName="apptSDV">
                                                            <EasingDoubleKeyFrame KeyTime="0" Value="0"/>
                                                            <EasingDoubleKeyFrame KeyTime="0:0:0.2" Value="0"/>
                                                            <EasingDoubleKeyFrame KeyTime="0:0:0.6" Value="1"/>
                                                        </DoubleAnimationUsingKeyFrames>
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </EventTrigger>
                                        </Grid.Resources>
                                        <Grid.Height>
                                            <Binding Converter="{StaticResource singelDayApptHeight}" Path="Appt"/>
                                        </Grid.Height>
                                        <Grid.Width>
                                            <Binding Converter="{StaticResource singelDayApptWidth}" Path="MaxConflicts"/>
                                        </Grid.Width>
                                        <i:Interaction.Behaviors>
                                            <cimbalinoBehaviors:MultiBindingBehavior Converter="{StaticResource singelDayApptTranslate}"
														PropertyName="RenderTransform">
                                                <cimbalinoBehaviors:MultiBindingItem Value="{Binding MaxConflicts}" />
                                                <cimbalinoBehaviors:MultiBindingItem Value="{Binding Column}" />
                                                <cimbalinoBehaviors:MultiBindingItem Value="{Binding StartTime}" />
                                            </cimbalinoBehaviors:MultiBindingBehavior>
                                        </i:Interaction.Behaviors>


                                        <StackPanel Margin="20,3,0,0">
                                            <TextBlock  Text="{Binding Subject}" Foreground="{Binding CalColor}" FontSize="{StaticResource DefaultSize}" FontWeight="Medium" />
                                            <TextBlock  Text="{Binding Location}" FontSize="22" Visibility="{Binding Converter={StaticResource NullOrWhiteSpaceCollapser}, Mode=OneWay}" Foreground="#FFA2A2A2" Margin="0,-6,0,0" />
                                            <TextBlock Text="{Binding Details}" FontSize="20.5" Foreground="#FF9C9C9C" FontWeight="ExtraLight" TextWrapping="Wrap" FontFamily="Calibri" Visibility="{Binding Converter={StaticResource DetailNotesCollapser}, Mode=OneWay}" />
                                        </StackPanel>
                                        <Rectangle Width="12" Fill="{Binding CalColor}" HorizontalAlignment="Left" >

                                            <i:Interaction.Behaviors>
                                                <cimbalinoBehaviors:MultiBindingBehavior Converter="{StaticResource singelDayApptRectangleMargin}"
															PropertyName="Margin">
                                                    <cimbalinoBehaviors:MultiBindingItem Value="{Binding StartTime}" />
                                                    <cimbalinoBehaviors:MultiBindingItem Value="{Binding Duration}" />
                                                </cimbalinoBehaviors:MultiBindingBehavior>
                                            </i:Interaction.Behaviors>
                                        </Rectangle>

                                        <Border BorderThickness="2,2,2,2" >
                                            <Border.BorderBrush>
                                                <SolidColorBrush Color="{StaticResource ColorBorderGrey}"/>
                                            </Border.BorderBrush>
                                        </Border>
                                    </Grid>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                        <Grid IsHitTestVisible="False">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="15*"/>
                                <ColumnDefinition Width="82*"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" BorderThickness="0,0,2,0">
                                <Border.BorderBrush>
                                    <SolidColorBrush Color="{StaticResource ColorBorderGrey}"/>
                                </Border.BorderBrush>
                            </Border>
                        </Grid>
                    </Grid>
                    <Border Height="1" Background="#FF807C7C"/>
                </StackPanel>
            </Grid>
        </ScrollViewer>
    </Grid>
</UserControl>